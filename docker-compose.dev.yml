version: '3.8'

# Development override - use with:
# docker-compose -f docker-compose.full.yml -f docker-compose.dev.yml up

services:
  app:
    build:
      target: development
    volumes:
      # Mount source code for hot reload
      - ./src:/app/src:ro
      - ./tests:/app/tests:ro
      - ./docs:/app/docs:ro
      # Prevent overwriting installed packages
      - /app/.venv
    environment:
      - ENVIRONMENT=development
      - LLM_PROVIDER=ollama
      - LOG_LEVEL=DEBUG
    ports:
      - "8000:8000"
      - "9229:9229"  # Debug port
    command: >
      uvicorn src.promtior_assistant.main:app
      --host 0.0.0.0
      --port 8000
      --reload
      --log-level debug
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G

  ollama:
    deploy:
      resources:
        limits:
          memory: 8G
